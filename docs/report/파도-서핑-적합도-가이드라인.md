# 파도 서핑 적합도 가이드라인

> **버전**: surf-rating v1.4.2 기준
> **최종 업데이트**: 2026-02-17
> **엔진 파일**: `surf-wave-backend/src/modules/forecasts/utils/surf-rating.util.ts`

---

## 1. 전체 점수 체계

### 1-1. 최종 점수 (surfRating)

| 점수 | 등급 | 신호등 | 의미 |
|------|------|--------|------|
| 9~10 | 최고 | 🟢 초록 | 완벽한 서핑 컨디션이에요! |
| 7~8 | 좋음 | 🟢 초록 | 서핑하기 좋은 날이에요! |
| 5~6 | 보통 | 🟡 노랑 | 무난한 컨디션이에요 |
| 3~4 | 나쁨 | 🔴 빨강 | 컨디션이 아쉬워요 |
| 1~2 | 최악 | 🔴 빨강 | 오늘은 쉬는 게 좋겠어요 |

### 1-2. 레벨별 적합도 (levelFit)

| 상태 | 의미 | 설명 |
|------|------|------|
| PASS | 통과 | 해당 레벨에서 서핑 가능 |
| WARNING | 주의 | 서핑은 가능하지만 주의 필요 |
| BLOCKED | 차단 | 해당 레벨에서 서핑 금지 (안전 문제) |

---

## 2. 하드블록 (안전 차단) 기준

> 점수 계산보다 **먼저** 실행. 위험 조건이면 점수와 관계없이 차단.

### 2-1. 바람 기준

| 조건 | 초보 | 중급 | 상급 | 비고 |
|------|------|------|------|------|
| effectiveWind > 35km/h | ❌ BLOCKED | ❌ BLOCKED | ❌ BLOCKED | 전 레벨 차단 |
| 돌풍(gust) ≥ 45km/h | ❌ BLOCKED | ⚠️ WARNING | - | |
| 돌풍(gust) ≥ 50km/h | ❌ BLOCKED | ❌ BLOCKED | - | |
| 돌풍(gust) ≥ 35km/h | ⚠️ WARNING | - | - | |

> **effectiveWind** = max(풍속, 돌풍 × 0.7)
> 예: 풍속 12km/h, 돌풍 25km/h → effectiveWind = max(12, 17.5) = **17.5km/h**

### 2-2. 파고 기준

| 조건 | 초보 | 중급 | 상급 |
|------|------|------|------|
| 파고 > 1.2m | ❌ BLOCKED | - | - |
| 파고 > 2.5m | - | ⚠️ WARNING | - |

> **Grace Zone (v1.4.2)**: 파고 1.2~1.4m + beach_break + 나머지 조건 매우 좋으면
> → 초보자 BLOCKED → WARNING으로 완화 (메시지: "경험자 동행 필수")
> → reef_break, point_break에서는 **절대 완화 안 함**

### 2-3. 스팟 유형 기준

| 조건 | 초보 | 중급 | 상급 |
|------|------|------|------|
| reef_break 또는 point_break | ❌ BLOCKED | - | - |
| 스팟 난이도 ADVANCED/EXPERT | ❌ BLOCKED | - | - |
| 스팟 난이도 EXPERT | - | ❌ BLOCKED | - |

### 2-4. 수온 기준

| 수온 | 초보 | 중급 | 상급 | 메시지 |
|------|------|------|------|--------|
| < 10°C | ❌ BLOCKED | ⚠️ WARNING | - | 저체온증 위험 |
| < 14°C | ⚠️ WARNING | - | - | 웻슈트 필수 |
| ≥ 14°C | - | - | - | (제한 없음) |

---

## 3. 파고 (waveFit) - 가중치 25%

> 서핑의 핵심. 파도가 없으면 아무리 다른 조건이 좋아도 서핑 불가.

### 3-1. breakType + 난이도별 파고 범위 (단위: m)

#### beach_break (비치 브레이크 / 모래바닥)

| 난이도 | 최적 구간 | 허용 구간 | 설명 |
|--------|----------|----------|------|
| BEGINNER | **0.5~1.0** | 0.3~1.2 | 무릎~허리 높이, 부드러운 파도 |
| INTERMEDIATE | **0.8~1.5** | 0.5~2.0 | 허리~가슴 높이 |
| ADVANCED | **1.0~2.0** | 0.5~2.5 | 가슴~머리 높이 |
| EXPERT | **1.5~2.5** | 0.8~3.5 | 머리 이상 |

#### reef_break (리프 브레이크 / 산호·암반)

| 난이도 | 최적 구간 | 허용 구간 | 설명 |
|--------|----------|----------|------|
| BEGINNER | **0.5~0.8** | 0.3~1.0 | 리프라 범위 좁음 |
| INTERMEDIATE | **1.0~2.0** | 0.8~2.5 | 리프 위 파도 |
| ADVANCED | **1.5~2.5** | 1.0~3.5 | |
| EXPERT | **2.0~3.5** | 1.5~5.0 | 대형 파도 |

#### point_break (포인트 브레이크 / 곶 지형)

| 난이도 | 최적 구간 | 허용 구간 | 설명 |
|--------|----------|----------|------|
| BEGINNER | **0.5~0.8** | 0.3~1.0 | |
| INTERMEDIATE | **1.0~1.8** | 0.8~2.5 | |
| ADVANCED | **1.5~2.5** | 1.0~3.5 | |
| EXPERT | **2.0~3.5** | 1.5~5.0 | |

#### beach_reef_break (혼합형)

| 난이도 | 최적 구간 | 허용 구간 | 설명 |
|--------|----------|----------|------|
| BEGINNER | **0.5~0.9** | 0.3~1.1 | beach와 reef 중간 |
| INTERMEDIATE | **0.9~1.8** | 0.6~2.3 | |
| ADVANCED | **1.2~2.2** | 0.8~3.0 | |
| EXPERT | **1.8~3.0** | 1.2~4.0 | |

### 3-2. 점수 계산 방식

```
파고가 최적 구간 안:          → 10점 (최적)
파고가 허용 구간 안:          → 3~9점 (선형 감점)
허용 경계에서 ±5cm 이내:     → 1~2점 (grace margin, 측정 오차 허용)
허용 구간 밖 (±5cm 초과):    → 0점 (서핑 부적합)
```

**예시 (beach_break + BEGINNER)**:
| 파고 | waveFit | 설명 |
|------|---------|------|
| 0.20m | 0점 | 허용 하한(0.3) 밖, grace도 밖 |
| 0.26m | 1.2점 | grace zone (0.25~0.30 사이) |
| 0.30m | 3점 | 허용 하한 경계 |
| 0.50m | 10점 | 최적 구간 시작 |
| 0.75m | 10점 | 최적 구간 중간 |
| 1.00m | 10점 | 최적 구간 끝 |
| 1.10m | 6점 | 허용 구간 중간 (감점) |
| 1.20m | 3점 | 허용 상한 경계 |
| 1.23m | 1.4점 | grace zone (1.20~1.25 사이) |
| 1.30m | 0점 | grace도 밖 |

### 3-3. waveMultiplier (파고 페널티)

> waveFit이 낮으면 **전체 점수**를 비례 감소시킴.
> "파도가 없으면 서핑도 없다"는 원칙.

| waveFit | waveMultiplier | 최종 점수 영향 |
|---------|---------------|---------------|
| 0 | ×0.20 | 다른 조건 만점이어도 최대 2점 |
| 1 | ×0.47 | 약 절반으로 감소 |
| 2 | ×0.73 | |
| 3 이상 | ×1.00 | 페널티 없음 |

---

## 4. 파주기 (periodFit) - 가중치 10%

> 주기가 길수록 = ground swell = 깨끗하고 파워 있는 파도.
> 짧은 주기 = wind swell = 지저분한 잔파.

| 파주기 | periodFit | 등급 | 설명 |
|--------|-----------|------|------|
| ≥ 14초 | 10점 | 최상급 | 최상급 ground swell |
| 12~13초 | 9점 | 매우 좋음 | 매우 좋은 ground swell |
| 10~11초 | 8점 | 좋음 | ground swell 진입 |
| 8~9초 | 7점 | 괜찮음 | 탈만한 파도 |
| 7초 | 5점 | 보통 | |
| 6초 | 3점 | 나쁨 | 겨우 탈 수 있음 |
| 5초 | 1점 | 매우 나쁨 | wind swell, 서핑 어려움 |
| < 5초 | 0점 | 불가 | 서핑 불가 수준 |

---

## 5. 풍속 (windSpeedFit) - 가중치 20%

> 바람이 약할수록 파도면이 깨끗 = 좋은 서핑 조건.
> effectiveWind = max(풍속, 돌풍 × 0.7) 사용.

| effectiveWind | windSpeedFit | 등급 | 설명 |
|---------------|-------------|------|------|
| < 5km/h | 10점 | 글래시 | 거울 같은 수면, 최고 |
| 5~9km/h | 8점 | 약한 바람 | 좋음 |
| 10~14km/h | 6점 | 보통 | 파도면 약간 흐트러짐 |
| 15~19km/h | 4점 | 강한 편 | 지저분해짐 |
| 20~24km/h | 2점 | 강풍 | 꽤 거칠어짐 |
| 25~34km/h | 1점 | 매우 강풍 | 나쁨 |
| ≥ 35km/h | 0점 | 위험 | 서핑 위험 (하드블록 차단) |

---

## 6. 스웰 매칭 (swellFit) - 가중치 25%

> 3가지 요소를 종합: **방향 60%** + **높이 25%** + **주기 15%**

### 6-1. 스웰 방향 매칭 (60%)

스팟의 `bestSwellDirection`(최적 스웰 방향)과 실제 스웰 방향의 각도 차이.

```
점수 = 10 × (1 - 각도차 / spread)
```

**breakType별 기본 spread (허용 각도 범위)**:

| breakType | spread | 설명 |
|-----------|--------|------|
| point_break | 25° | 가장 민감 (방향이 정확해야 파도가 열림) |
| reef_break | 30° | 민감 |
| beach_reef_break | 35° | |
| beach_break | 45° | 가장 관대 |

**예시 (beach_break, spread=45°)**:
| 각도 차이 | 방향 점수 | 설명 |
|-----------|----------|------|
| 0° | 10점 | 완벽한 매칭 |
| 15° | 6.7점 | 약간 빗나감 |
| 30° | 3.3점 | 많이 빗나감 |
| 45° 이상 | 0점 | 매칭 실패 |

### 6-2. 스웰 높이 (25%)

| 스웰 높이 | 점수 | 설명 |
|-----------|------|------|
| < 0.3m | 0점 | 스웰 거의 없음 |
| 0.3~1.5m | 0~10 선형 | 점점 증가 |
| ≥ 1.5m | 10점 | 충분한 스웰 |

### 6-3. 스웰 주기 (15%)

| 스웰 주기 | 점수 | 설명 |
|-----------|------|------|
| ≥ 14초 | 10점 | 최상급 ground swell |
| 10~13초 | 8점 | ground swell |
| 8~9초 | 6점 | |
| 6~7초 | 3점 | wind swell 영역 |
| < 6초 | 1점 | 잔파 |

---

## 7. 풍향 (windDirFit) - 가중치 20%

> 오프쇼어(육지→바다) = 파도면 깨끗 = 최고.
> 온쇼어(바다→육지) = 파도면 엉망 = 최악.

### 7-1. 풍향 판정 방식

```
1. 기상 데이터의 풍향은 "FROM"(불어오는) 방향
   → "TO"(향하는) 방향으로 변환: wind_to = (wind_from + 180) % 360

2. 해안 방향(coastFacingDeg)과 비교:
   - 차이 작음 → 바람이 바다 쪽으로 → 오프쇼어
   - 차이 큼(~180°) → 바람이 육지 쪽으로 → 온쇼어
```

### 7-2. 점수 기준

| 각도 차이 (wind_to vs coastFacing) | windDirFit | 풍향 유형 | 설명 |
|-----------------------------------|-----------|----------|------|
| 0~29° | 10점 | 오프쇼어 | 파도면 깨끗, 최고 |
| 30~59° | 8점 | 사이드오프 | 좋음 |
| 60~89° | 5점 | 크로스쇼어 | 보통 |
| 90~119° | 3점 | 사이드온 | 나쁜 편 |
| ≥ 120° | 1점 | 온쇼어 | 파도면 엉망, 최악 |

### 7-3. 약풍 보정 (v1.4.2)

> 바람이 거의 없으면 풍향 자체가 무의미 → windDirFit을 올려줌.

| effectiveWind | 보정 | 설명 |
|---------------|------|------|
| < 5km/h (글래시) | windDirFit = max(기존, **7**) | 풍향 무의미 |
| 5~7km/h (매우 약함) | windDirFit = max(기존, **(기존+7)/2**) | 부분 보정 |
| ≥ 8km/h | 보정 없음 | 풍향 의미 있음 |

---

## 8. 가중치 합산

### 8-1. 항목별 가중치

| 항목 | 가중치 | 역할 |
|------|--------|------|
| waveFit (파고) | 25% | 서핑 가능 여부의 핵심 |
| swellFit (스웰 매칭) | 25% | 방향+높이+주기 종합 |
| windSpeedFit (풍속) | 20% | 파도면 품질 |
| windDirFit (풍향) | 20% | 오프쇼어/온쇼어 |
| periodFit (파주기) | 10% | ground/wind swell 구분 |

### 8-2. 계산 공식

```
rawScore = waveFit×0.25 + swellFit×0.25 + windSpeedFit×0.20 + windDirFit×0.20 + periodFit×0.10

surfRating = rawScore × waveMultiplier
```

---

## 9. 보정 필터

> 가중합 이후 적용되는 추가 보정. 거짓양성/거짓음성을 잡아줌.

### 9-1. 거짓양성 보정 (v1.4.1)

#### ① 복합 위험 감점 (Compound Risk)

> 초보자 전용. 여러 위험 요소가 "간신히 통과" 수준이면 종합적으로 위험.

**3개 근접도 항목**:

| 항목 | 측정 범위 | 가중치 | 설명 |
|------|----------|--------|------|
| 돌풍 근접도 | gust 30~45km/h | 1.0 | 가장 결정적 |
| 파고 근접도 | tolMax×0.9 ~ tolMax | 0.8 | 상한 "바로 아래" |
| 수온 근접도 | 14~16°C | 0.7 | 상대적 낮은 위험 |

```
riskIndex = 돌풍근접도×1.0 + 파고근접도×0.8 + 수온근접도×0.7
```

| riskIndex | 감점 | 효과 |
|-----------|------|------|
| < 1.0 | 없음 | |
| 1.0~1.49 | ×0.70 (30% 감점) | BEGINNER → WARNING + "장비 착용 권장" |
| ≥ 1.5 | ×0.60 (40% 감점) | BEGINNER → WARNING + "장비 착용 필수" |

#### ② 품질 게이트 (Quality Gate)

> 최악의 조합 패턴이면 점수 상한을 제한.

| 조건 | 상한 | 효과 |
|------|------|------|
| windDirFit ≤ 2 (온쇼어) **AND** periodFit ≤ 2 (짧은 주기) | **최대 4.0점** | BEGINNER → WARNING |

### 9-2. 거짓음성 보정 (v1.4.2)

#### ③ 하드블록 Grace Zone

| 조건 (전부 충족 시) | 결과 |
|---------------------|------|
| 초보자 BLOCKED 상태 | |
| 파고 1.2~1.4m | |
| breakType = beach_break | |
| 나머지 4개 fit 평균 ≥ 7.0 | BLOCKED → **WARNING** |

> reef/point에서는 **절대 완화 안 함**.
> 메시지: "초보에겐 여전히 높은 파고, 경험자 동행 필수"

---

## 10. 간단 컨디션 요약 (프론트엔드 표시)

### 10-1. 파도 상태

| 파고 | 표시 |
|------|------|
| < 0.5m | 잔잔 |
| 0.5~1.5m | 적당 |
| 1.5~2.5m | 높음 |
| > 2.5m | 위험 |

### 10-2. 바람 상태

| effectiveWind | 표시 |
|---------------|------|
| < 10km/h | 약함 |
| 10~20km/h | 보통 |
| 20~30km/h | 강함 |
| > 30km/h | 매우 강함 |

### 10-3. 전체 상태

| 조건 | 표시 |
|------|------|
| 파고 0.5~1.5m **AND** effectiveWind < 20 | 좋음 |
| 파고 > 2.5m **OR** effectiveWind > 30 | 주의 |
| 그 외 | 보통 |

---

## 11. 계산 파이프라인 전체 흐름

```
입력: 스팟 정보 + 예보 데이터 + 사용자 레벨

STEP 1: 하드블록 안전 필터
  → 위험 조건 먼저 차단 (BLOCKED / WARNING / PASS)
  → 차단되어도 점수는 계산함 (참고용)

STEP 2: 5개 fit 점수 계산 (각 0~10점)
  ① waveFit   - 파고 적합도 (grace margin ±5cm 포함)
  ② periodFit - 파주기 적합도
  ③ windSpeedFit - 풍속 적합도
  ④ swellFit  - 스웰 매칭 (방향+높이+주기)
  ⑤ windDirFit - 풍향 적합도

STEP 2.5: 약풍 보정
  → effectiveWind < 8이면 windDirFit 보정

STEP 3: 가중 합산
  rawScore = 5개 fit × 가중치
  surfRating = rawScore × waveMultiplier

STEP 3.5: 거짓양성 보정
  ① 복합 위험 감점 (riskIndex 기반)
  ② 품질 게이트 (온쇼어+짧은주기 → 최대 4점)

STEP 3.7: 거짓음성 보정
  ③ 하드블록 grace zone (beach_break + 1.2~1.4m → WARNING)

STEP 4: 결과 생성
  → 점수 + 레벨 적합도 + 상세 점수 + 추천 메시지 + 안전 사유
```

---

## 12. 실전 예시

### 예시 A: 양양 죽도 - 완벽한 날

```
스팟: beach_break, BEGINNER, coastFacing=90°
예보: 파고 0.8m, 주기 10s, 풍속 5km/h, 스웰방향 E, 풍향 270°(서→동)

STEP 1: 하드블록 → 전부 PASS (파고 1.2 이하, 풍속 안전)
STEP 2:
  waveFit = 10 (0.5~1.0 최적 구간 안)
  periodFit = 8 (10초 = ground swell 진입)
  windSpeedFit = 8 (effectiveWind=5 < 10)
  swellFit = ~8 (방향 매칭 좋음 + 적당한 스웰)
  windDirFit = 10 (풍향 270°→to=90° = coastFacing과 동일 = 오프쇼어)
STEP 3: rawScore ≈ 9.0, waveMultiplier = 1.0
  → surfRating ≈ 9.0

결과: 🟢 9점 "완벽한 서핑 컨디션이에요!"
```

### 예시 B: 양양 죽도 - 초보자에게 약간 높은 파도

```
스팟: beach_break, BEGINNER, coastFacing=90°
예보: 파고 1.3m, 주기 11s, 풍속 6km/h, 조건 전부 좋음

STEP 1: 파고 1.3m > 1.2 → BEGINNER BLOCKED
STEP 2: 나머지 fit 평균 ≈ 8.5 (≥ 7.0)
STEP 3.7: grace zone 발동
  → beach_break + 1.2~1.4m + fit평균 좋음
  → BLOCKED → WARNING

결과: ⚠️ WARNING "경험자 동행 필수"
```

### 예시 C: 발리 울루와투 - 초보자 차단

```
스팟: reef_break, ADVANCED, coastFacing=210°
예보: 파고 1.8m, 주기 14s, 풍속 8km/h

STEP 1:
  reef_break → BEGINNER BLOCKED
  ADVANCED 스팟 → BEGINNER BLOCKED
  → 이중 차단 (스팟 자체가 초보자 금지)

결과: ❌ BLOCKED "리프/포인트 브레이크 - 초보자 서핑 금지; 상급자 전용 스팟입니다"
```

### 예시 D: 글래시(무풍) + 온쇼어

```
스팟: beach_break, BEGINNER, coastFacing=90°
예보: 파고 0.7m, 주기 8s, 풍속 3km/h, 풍향 90°(→to=270°, 온쇼어)

STEP 2: windDirFit = 1 (온쇼어, 120° 이상 차이)
STEP 2.5: effectiveWind=3 < 5 → windDirFit = max(1, 7) = 7
  → 글래시니까 풍향 무의미, 보정됨

결과: 풍향 때문에 과도하게 깎이지 않음
```
